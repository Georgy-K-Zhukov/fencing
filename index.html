<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="keywords" content="parry-riposte" />
    <meta name="description" content="Easy Calls" />
    <title>Easy Calls - Berder Egorian 9-13 T4 2017 Seoul W GP</title>
    <link rel="stylesheet" href="index.css" type="text/css" />
  </head>

  <body id="body">
    <header>
      <div id="header">
        <div id="headernav">
          <ul>
            <li><a href="#About" class="topbar">About</a></li>
            <li>
              <div class="dropdown">
                <button class="dropmenu">Clips &#9662;</button>
                <div class="dropdown-content">
                  <a href="#EasyCalls">Easy Calls</a>
                  <a href="#SeparationCalls">Separation Calls</a>
                  <a href="#OtherCalls">Other Calls</a>
                  <a href="#OtherCalls">All Calls</a>
                </div>
              </div>
            </li>
            <li><a href="#Analysis" class="topbar">Analysis</a></li>
          </ul>
        </div>
      </div>
    </header>

    <div id="videocall">
      <div style="position:relative;padding-bottom:54%">
        <video
          frameborder="0"
          scrolling="no"
          width="100%"
          height="100%"
          style="position:absolute;top:0;left:0"
          allowfullscreen
          loop
          autoplay
          controls
          id="theaction"
        >
          <source id="videoWebM" src="" type="video/webm" />
          <source id="videoMp4" src="" type="video/mp4" />
          Your browser does not support the video tag.
        </video>
      </div>
    </div>
    <div id="speedcontrols">
      <button onclick="halfspeed()" type="button" class="half">
        1/2 Speed
      </button>
      <button onclick="threequarters()" type="button" class="threefour">
        3/4 Speed
      </button>
      <button onclick="normalspeed()" type="button" class="full">
        Normal Speed
      </button>
    </div>

    <div id="vidname"><p class="videoname" id="videoTitle"></p></div>

    <div class="centered">
      <input
        type="button"
        onclick="changeText()"
        value="Show the Call"
        class="answerbutton"
      />
    </div>
    <div>
      <p class="answertext"><b id="answer"></b></p>
    </div>
    <div>
      <p class="explaintext"><b id="explain"></b></p>
    </div>

    <div id="Extras">
      <ul>
        <li>
          <input
            type="button"
            onclick="location.href='https://gfycat.com/MildSlimHerring';"
            value="Clip via GfyCat"
            class="extra"
          />
        </li>
        <li>
          <input
            type="button"
            onclick="location.href='https://gfycat.com/MildSlimHerring';"
            value="Full Bout on YouTube"
            class="extra"
          />
        </li>
      </ul>
    </div>
  </body>

  <footer>
    <div id="footer">
      <li>
        <div id="footerbuttons">
          <input
            type="button"
            class="navbuttons"
            onclick="location.href='Previous';"
            value="&laquo; Previous"
          />
          <input
            type="button"
            class="navbuttons"
            onclick="location.href='Randomscript';"
            value="Random"
          />
          <input
            type="button"
            class="navbuttons"
            onclick="location.href='next';"
            value="Next &raquo;"
          />
        </div>
      </li>
    </div>
  </footer>

  <!--- Scripts --->

  <!--- Show Answer Script --->
  <script>
    function changeText() {
      const action = data.feed.entry[id];
      document.getElementById("answer").innerHTML = action.gsx$callanswer.$t;
      document.getElementById("explain").innerHTML =
        action.gsx$callexplanationifneeded.$t;
    }
  </script>

  <!--- Speed Scripts --->

  <script>
    var vid = document.getElementById("theaction");

    function halfspeed() {
      vid.playbackRate = 0.5;
    }

    function threequarters() {
      vid.playbackRate = 0.75;
    }

    function normalspeed() {
      vid.playbackRate = 1;
    }
  </script>

  <!--- Populate Page Script --->
  <script>
    const rows = [];
    /*const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");

    const videoWebM = document.getElementById("videoWebM");
    const videoTitle = document.getElementById("videoTitle");
    const videoMp4 = document.getElementById("videoMp4");
    const theAction = document.getElementById("theaction");
    const action = data.feed.entry[id];

    videoWebM.src = action.gsx$hdmp4link.$t;
    videoMp4.src = action.gsx$hdwebmlink.$t;
    theAction.load();

    videoTitle.innerHTML = action.gsx$videotitle.$t;*/

    /* Fetches the sheet data. This is an async function.
     * Apologies for using something fancy, but frankly
     * I wasn't sure the Promise version would have been much better
     * (let alone the callback version). Basically this fetches the data,
     * checks that we got a good response, then turns it into json.
     * It then calls processSheetData
     *
     * If you're wondering, hey Nick, why did you call processSheetData
     * instead of returning the jsonBody out and then calling it there?
     * Well, that's because of async functions. Basically, async functions
     * don't return regular values. They return Promises, which you can
     * think of as an object that may eventually receive a value. You can
     * tell a Promise what to do when it receives said value. If this confuses
     * you (as it did to me), just trust me, this works better.
     */
    async function fetchSheetData() {
      const res = await fetch(
        "https://spreadsheets.google.com/feeds/cells/114G_p1m7iPEFBlaClJOYrdfn4LdS3fmR1v1YfuY035M/1/public/full?alt=json"
      );
      if (!res.ok) {
        throw new Error(`Server returned error with status code ${res.status}`);
      }
      const jsonBody = await res.json();
      processSheetData(jsonBody);
    }

    /* The field names for each entry.
     * We use this array to get the field name that we need
     * for the corresponding entry in the raw data. Basically
     * this allows us to link the column numbers to the field names.
     */
    const fieldNames = [
      "videoTitle",
      "callAnswer",
      "callExplanation",
      "callType",
      "callGroup",
      "hdWebMLink",
      "hdMP4Link",
      "gfyLink",
      "tags",
      "youtubeLink",
      "exclude"
    ];
    // Each object we're producing has 11 fields. To figure out
    // which field name corresponds to this entry, we need the
    // column number which is (i % 11), or the remainder when
    // you divide the entries by 11, the number of columns in
    // a row.
    function getFieldName(entryIndex) {
      return fieldNames[entryIndex % 11];
    }

    /*
     * Processes the raw JSON returned by Google Sheets into an array of objects
     * Each object has the same fields, as detailed above in the array fieldNames
     */
    function processSheetData(jsonBody) {
      const entries = jsonBody.feed.entry;
      let currentRow = {};
      // Starting with 11 cause we skip the header row
      for (let i = 11; i < entries.length; i++) {
        const entry = entries[i];
        // We get the field name for the entry and set that
        // field in currentRow to the content of the entry.
        currentRow[getFieldName(i)] = entry.content["$t"];
        // If we've reached the last entry in the current row, we add it
        // to the array of rows and then set currentRow to a new object
        if ((i + 1) % 11 === 0) {
          rows.push(currentRow);
          currentRow = {};
        }
      }
    }
    fetchSheetData();
  </script>
</html>
